<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <!-- Bootstrap CSS 5.1.3 - 04/2022 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Fontawesome 6.1.1 - 04/2022 -->

    <!-- Fonte do texto -->

    <title>Portal de Filmes</title>
</head>

<body>
    <header class="header">
        <!-- Barra de navegação superior -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <img class="navbar-brand img-fluid rounded-circle" style="max-width: 64px;" src="images/logo.png" alt="logo">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <form class="d-flex">
                        <input class="form-control me-2" type="search" placeholder="Pesquisar filme"
                            aria-label="Search">
                        <button class="btn btn-outline-light" type="submit">Pesquisar</button>
                    </form>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <!-- Bloco de Lançamento -->
        <div class="bg-secondary">
            <div class="container main">
                <h2 class="lancamentos py-4 text-center" id="lancamentos">Lançamentos</h2>
            </div>
            <div class="container">
                <div class="row">
                    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-indicators">
                            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0"
                                class="active" aria-current="true" aria-label="Slide 1"></button>
                            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                                aria-label="Slide 2"></button>
                            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
                                aria-label="Slide 3"></button>
                            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3"
                                aria-label="Slide 4"></button>
                        </div>

                        <!-- 1 Filme -->
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <div class="row" style="margin-bottom: 35px;">
                                    <div class="col-xs-12 col-12 col-md-6" style="min-height: 294px;">
                                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/oZ6iiRrz1SY"
                                            title="YouTube video player" frameborder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen></iframe>
                                    </div>
                                    <div class="col-xs-12 col-12 col-md-6 d-flex flex-column">
                                        <p class="mb-auto">
                                            <h1>Morbius</h1>
                                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque lorem sem, semper in scelerisque in, pulvinar et dolor. Cras vehicula consectetur ligula id fermentum. Etiam nisl sapien, rutrum quis dolor vitae, volutpat maximus nunc. Curabitur luctus odio sed leo vestibulum congue. Integer eget mattis arcu, nec auctor eros. Duis posuere quis massa ac ultrices. Mauris id sapien nec lectus gravida lacinia faucibus sit amet erat.
                                        </p>
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Diretor:</b> Daniel Espinosa
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Roteiro:</b> Matt Sazama, Burk Sharpless
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Elenco:</b> 
                                                Jared Leto, Michael Keaton, Matt Smith, Adria Arjona, Jared Harris, Tyrese Gibson, Al Madrigal, Archie Renaux, Clara Rosager, Corey Johnson, Charlie Shotwell, Tom Forbes
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <b>Estreia:</b> 2022
                                        </div>

                                        <div class="col-12">
                                            <b>Avaliação:</b> 2/10
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="carousel-item">
                                <div class="row" style="margin-bottom: 35px;">
                                    <div class="col-xs-12 col-12 col-md-6" style="min-height: 294px;">
                                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/HJv4LQxbVEA"
                                            title="YouTube video player" frameborder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen></iframe>
                                    </div>
                                    <div class="col-xs-12 col-12 col-md-6 d-flex flex-column">
                                        <p class="mb-auto">
                                            <h1>Batman</h1>
                                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque lorem sem, semper in scelerisque in, pulvinar et dolor. Cras vehicula consectetur ligula id fermentum. Etiam nisl sapien, rutrum quis dolor vitae, volutpat maximus nunc. Curabitur luctus odio sed leo vestibulum congue. Integer eget mattis arcu, nec auctor eros. Duis posuere quis massa ac ultrices. Mauris id sapien nec lectus gravida lacinia faucibus sit amet erat.
                                        </p>
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Diretor:</b> Matt Reeves
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Roteiro:</b> Matt Reeves
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Elenco:</b> Robert Pattinson, Zoë Kravitz, Paul Dano, Colin Farrell, Jeffrey Wright, John Turturro, Andy Serkis, Ben Affleck, Barry Keoghan, Peter Sarsgaard, Max Carver, Jayme Lawson
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <b>Estreia:</b> 2022
                                        </div>

                                        <div class="col-12">
                                            <b>Avaliação:</b> 7/10
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="carousel-item">
                                <div class="row" style="margin-bottom: 35px;">
                                    <div class="col-xs-12 col-12 col-md-6" style="min-height: 294px;">
                                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/WDbNlaZs"
                                            title="YouTube video player" frameborder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen></iframe>
                                    </div>
                                    <div class="col-xs-12 col-12 col-md-6 d-flex flex-column">
                                        <p class="mb-auto">
                                            <h1>Animais Fantásticos: Os Segredos de Dumbledore</h1>
                                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque lorem sem, semper in scelerisque in, pulvinar et dolor. Cras vehicula consectetur ligula id fermentum. Etiam nisl sapien, rutrum quis dolor vitae, volutpat maximus nunc. Curabitur luctus odio sed leo vestibulum congue. Integer eget mattis arcu, nec auctor eros. Duis posuere quis massa ac ultrices. Mauris id sapien nec lectus gravida lacinia faucibus sit amet erat.
                                        </p>
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Diretor:</b> David Yates
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Roteiro:</b> J. K. Rowling
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Elenco:</b> Mads Mikkelsen, Eddie Redmayne, Jude Law, Katherine Waterston, Ezra Miller, Dan Fogler, Callum Turner
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <b>Estreia:</b> 2022
                                        </div>

                                        <div class="col-12">
                                            <b>Avaliação:</b> 8/10
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="carousel-item">
                                <div class="row" style="margin-bottom: 35px;">
                                    <div class="col-xs-12 col-12 col-md-6" style="min-height: 294px;">
                                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/YdAIBlPVe9s"
                                            title="YouTube video player" frameborder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen></iframe>
                                    </div>
                                    <div class="col-xs-12 col-12 col-md-6 d-flex flex-column">
                                        <p class="mb-auto">
                                            <h1>Luca</h1>
                                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque lorem sem, semper in scelerisque in, pulvinar et dolor. Cras vehicula consectetur ligula id fermentum. Etiam nisl sapien, rutrum quis dolor vitae, volutpat maximus nunc. Curabitur luctus odio sed leo vestibulum congue. Integer eget mattis arcu, nec auctor eros. Duis posuere quis massa ac ultrices. Mauris id sapien nec lectus gravida lacinia faucibus sit amet erat.
                                        </p>
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Diretor:</b> Enrico Casarosa
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Roteiro:</b> Enrico Casarosa, Jesse Andrews, Simon Stephenson
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-4">
                                                <b>Elenco:</b> Robert Pattinson, Zoë Kravitz, Paul Dano, Colin Farrell, Jeffrey Wright, John Turturro, Andy Serkis, Ben Affleck, Barry Keoghan, Peter Sarsgaard, Max Carver, Jayme Lawson
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <b>Estreia:</b> 2022
                                        </div>

                                        <div class="col-12">
                                            <b>Avaliação:</b> 9/10
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bloco de Destaque -->
        <div class="container">
            <div class="row py-4">
                <div class="col-6">
                    <h2 class="destaques" id="destaques">Em destaque</h2>
                </div>
                <!-- <div class="col-6">
                    <div class="dropdown" style="text-align: right;">
                        <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Categoria: Todas
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                            <li><a class="dropdown-item" href="#">Aventura</a></li>
                            <li><a class="dropdown-item" href="#">Romance</a></li>
                            <li><a class="dropdown-item" href="#">Comédia</a></li>
                        </ul>
                    </div>
                </div> -->
            </div>
        </div>
        <div class="container">
            <div class="row" id="filmes">
                
                <div class="col-md-3 mt-2 d-none card-filme" id="templateCardFilme">
                    <div class="card h-100" widht="100%" style="cursor: pointer">
                        <img src="" class="card-img-top h-100" alt="filme1">
                        <div class="card-body">
                            <p class="card-text"><b></b></p>
                        </div>
                        <div class="card-footer">
                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-100 d-flex d-none flex-row justify-content-center p-5" id="spinnerMovies">
                <div class="spinner-border" role="status">
    
                </div>
            </div>
        </div>
        <div class="container" style="text-align: right; margin-top: 10px;">
            <div class="row">
                <div class="col-12">
                    <button id="btnMoreMovies" type="button" class="btn btn-secondary btn-sm">+ Carregar mais filmes</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Rodapé -->
    <footer>
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            <p class="footertext">© 2022 Copyright: Desenvolvimento de Interfaces Web -
                <b>Davi Fernandes Ferreira Silva</b>
            </p>
        </div>
    </footer>

    <!-- Bootstrap Javascript 2.10 - 04/2022 -->

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" 
        crossorigin="anonymous"></script>-->

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <script src="js/moment.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
    <script src="js/script.js"></script>
    <script>
        const API_KEY_v4 = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJkZDFjNGY2MGE3YTY3OTdkNjI1MDY4MzViMjM1NjlhNiIsInN1YiI6IjYyYjI2MTU5Mzg3NjUxMDA1MWNlNDg4YSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.7XPnTNiHnxSN6iI11p0sw9HVGGyi30vFZgRLSzCQBEk';
        const API_KEY_v3 = 'dd1c4f60a7a6797d62506835b23569a6';
        const ROOT_API_ENDPOINT = 'https://api.themoviedb.org/3';
        const ROOT_IMAGE_ENDPOINT = 'https://image.tmdb.org/t/p/original/';
        
        let genres = {};
        let movies = {};
        let current_movies_page = 0;

        const handleMovies = (movies_api_result) => {
            console.log(movies_api_result);
            movies_api_result.results.forEach(movie => {
                movies[movie.id] = movie;
            });
            console.log(movies);
        }

        const handleGenres = (genres_api_result) => {
            console.log(genres_api_result);
            genres_api_result.genres.forEach(genre => {
                genres[genre.id] = genre;
            });
            console.log(genres);
        }

        const loadDataToPage = () => {
            const templateCard = $("#templateCardFilme");
            let cardAtual, movieAtual, badges;
            for(movieKey in movies){
                movieAtual = movies[movieKey];
                if(movieAtual.movie_loaded) continue;

                cardAtual =  templateCard.clone();
                badges = '';
                cardAtual.removeClass('d-none');
                cardAtual.find(".card").attr("data-filme-id", movieAtual.id);
                cardAtual.find("img").attr("src", `${ROOT_IMAGE_ENDPOINT}${movieAtual.poster_path}?api_key=${API_KEY_v3}`).attr("alt", movieAtual.title);
                cardAtual.find(".card-text").html(`<b>${movieAtual.title}</b>`);
                badges = movieAtual.genre_ids.reduce((fullText, currentGenre) => {
                    fullText += `<span class="badge badge-primary text-dark">${genres[currentGenre].name}</span>`
                    return fullText;
                }, '');
                cardAtual.find(".card-footer").append('<b>Lançamento:</b> ' + moment(movieAtual.release_date).format('DD/MM/YYYY') + '<br><b>Gênero(s): </b>');
                cardAtual.find(".card-footer").append(badges == '' ? 'Nenhum gênero encontrado' : badges);
                $(cardAtual).appendTo("#filmes");
                movies[movieKey].movie_loaded = true;
            }
            $("#btnMoreMovies").removeClass("d-none");
            $("#spinnerMovies").addClass("d-none");
            $(".card-filme .card").unbind('click');
            $(".card-filme .card").click(handleClickFilme);
        }

        const handleClickFilme = (event) => {
            event.preventDefault();
            const movieId = $(event.currentTarget).attr("data-filme-id");
            window.location = 'detalhe.html?movieId=' + movieId;
        }

        const generateMoviesRequestConfig = (pageIndex = 1) => {
            return {
                url: `${ROOT_API_ENDPOINT}/movie/now_playing`,
                headers: {
                    'Authorization': `Bearer ${API_KEY_v4}`
                },
                data: {
                    region: 'BR',
                    language: 'pt-BR',
                    page: pageIndex
                },
                method: 'GET',
                dataType: 'json',
                success: handleMovies
            }
        }

        const generateGenresRequestConfig = () => {
            return {
                url: `${ROOT_API_ENDPOINT}/genre/movie/list`,
                headers: {
                    'Authorization': `Bearer ${API_KEY_v4}`
                },
                data: {
                    language: 'pt-BR'
                },
                method: 'GET',
                dataType: 'json',
                success: handleGenres
            }
        }

        const getMoreMovies = () => {
            $("#spinnerMovies").removeClass("d-none");
            Promise.all([
                $.ajax(generateMoviesRequestConfig(++current_movies_page)),
                $.ajax(generateGenresRequestConfig())
            ]).then(values => {
                loadDataToPage();
            })
        }


        
        $(document).ready(() => {
            getMoreMovies();
            $("#btnMoreMovies").click(getMoreMovies);
        });
    </script>
</body>

</html>